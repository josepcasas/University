results <- cbind(results, gdp)
}
return(result)
}
counterfactual(country, year, dataset)
# define some aux list
years <- c(year:(year+5))
haircuts <- seq(0, 1, by=.1)
# This function will create the counterfactual graph for a given country and restructure year
counterfactual <- function(country, year, dataset){
# Counterfactual for growth in t+0
# Standard Growth Regression + restructure + haircut + haircut2 + haircut3 + debt + fx (FE + Arellano)
gt0 <- plm(growth ~ lag(growth) + lag(growth, k=2) + pop + hc + log(gdp) + log(capital) + productivity + cpi + restructure + haircut + I(haircut^2) + I(haircut^3) + debt + fx + haircut * fx, data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt0r <- coeftest(gt0, vcov.=vcovHC(gt0))
# Counterfactual for growth in t+1
gt1 <- plm(growth ~ lag(growth, k = 2) + lag(growth, k=3) + lag(pop) + lag(hc) + lag(log(gdp)) + lag(log(capital)) + lag(productivity) + lag(cpi) + lag(restructure) + lag(haircut) + lag(I(haircut^2)) + lag(I(haircut^3)) + lag(debt) + lag(fx) + lag(haircut * fx), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt1r <- coeftest(gt1, vcov.=vcovHC(gt1))
# Counterfactual for growth in t+2
gt2 <- plm(growth ~ lag(growth, k = 3) + lag(growth, k=4) + lag(pop, k = 2) + lag(hc, k = 2) + lag(log(gdp), k = 2) + lag(log(capital), k = 2) + lag(productivity, k = 2) + lag(cpi, k = 2) + lag(restructure, k = 2) + lag(haircut, k = 2) + lag(I(haircut^2), k = 2) + lag(I(haircut^3), k = 2) + lag(debt, k = 2) + lag(fx, k = 2) + lag(haircut * fx, k = 2), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt2r <- coeftest(gt2, vcov.=vcovHC(gt2))
# Counterfactual for growth in t+3
gt3 <- plm(growth ~ lag(growth, k = 4) + lag(growth, k=5) + lag(pop, k = 3) + lag(hc, k = 3) + lag(log(gdp), k = 3) + lag(log(capital), k = 3) + lag(productivity, k = 3) + lag(cpi, k = 3) + lag(restructure, k = 3) + lag(haircut, k = 3) + lag(I(haircut^2), k = 3) + lag(I(haircut^3), k = 3) + lag(debt, k = 3) + lag(fx, k = 3) + lag(haircut * fx, k = 3), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt3r <- coeftest(gt3, vcov.=vcovHC(gt3))
# Counterfactual for growth in t+4
gt4 <- plm(growth ~ lag(growth, k = 5) + lag(growth, k=6) + lag(pop, k = 4) + lag(hc, k = 4) + lag(log(gdp), k = 4) + lag(log(capital), k = 4) + lag(productivity, k = 4) + lag(cpi, k = 4) + lag(restructure, k = 4) + lag(haircut, k = 4) + lag(I(haircut^2), k = 4) + lag(I(haircut^3), k = 4) + lag(debt, k = 4) + lag(fx, k = 4) + lag(haircut * fx, k = 4), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt4r <- coeftest(gt4, vcov.=vcovHC(gt4))
results <- data.frame(years)
# define some aux list
years <- c(year:(year+5))
haircuts <- seq(0, 1, by=.1)
# loop through the five regressions
# predict the growth rate
# calculate the gdp
for (i in 1:length(haircuts)){
print(i)
for (j in 1:(length(years))){
print (j)
# initialize the vectors to store growth and gdp
gs <- c()
gdp <- c(dataset$gdp[which(dataset$country==country & dataset$year == year)])
fe <- c()
# we need to calculate the FE for each period
# NOTE: I do not know how to do it "nicer"
if (j == 1){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt0, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt0r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 2){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt1, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
print(fe[j])
gs[j] <- fe[j] + predict.cf(gt1r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
print(gdp[j+1])
}
if (j == 3){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt2, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt2r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 4){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt3, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt3r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 5){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt4, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt4r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
}
print(gdp)
results <- cbind(results, gdp)
}
return(result)
}
counterfactual(country, year, dataset)
# This function will create the counterfactual graph for a given country and restructure year
counterfactual <- function(country, year, dataset){
# Counterfactual for growth in t+0
# Standard Growth Regression + restructure + haircut + haircut2 + haircut3 + debt + fx (FE + Arellano)
gt0 <- plm(growth ~ lag(growth) + lag(growth, k=2) + pop + hc + log(gdp) + log(capital) + productivity + cpi + restructure + haircut + I(haircut^2) + I(haircut^3) + debt + fx + haircut * fx, data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt0r <- coeftest(gt0, vcov.=vcovHC(gt0))
# Counterfactual for growth in t+1
gt1 <- plm(growth ~ lag(growth, k = 2) + lag(growth, k=3) + lag(pop) + lag(hc) + lag(log(gdp)) + lag(log(capital)) + lag(productivity) + lag(cpi) + lag(restructure) + lag(haircut) + lag(I(haircut^2)) + lag(I(haircut^3)) + lag(debt) + lag(fx) + lag(haircut * fx), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt1r <- coeftest(gt1, vcov.=vcovHC(gt1))
# Counterfactual for growth in t+2
gt2 <- plm(growth ~ lag(growth, k = 3) + lag(growth, k=4) + lag(pop, k = 2) + lag(hc, k = 2) + lag(log(gdp), k = 2) + lag(log(capital), k = 2) + lag(productivity, k = 2) + lag(cpi, k = 2) + lag(restructure, k = 2) + lag(haircut, k = 2) + lag(I(haircut^2), k = 2) + lag(I(haircut^3), k = 2) + lag(debt, k = 2) + lag(fx, k = 2) + lag(haircut * fx, k = 2), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt2r <- coeftest(gt2, vcov.=vcovHC(gt2))
# Counterfactual for growth in t+3
gt3 <- plm(growth ~ lag(growth, k = 4) + lag(growth, k=5) + lag(pop, k = 3) + lag(hc, k = 3) + lag(log(gdp), k = 3) + lag(log(capital), k = 3) + lag(productivity, k = 3) + lag(cpi, k = 3) + lag(restructure, k = 3) + lag(haircut, k = 3) + lag(I(haircut^2), k = 3) + lag(I(haircut^3), k = 3) + lag(debt, k = 3) + lag(fx, k = 3) + lag(haircut * fx, k = 3), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt3r <- coeftest(gt3, vcov.=vcovHC(gt3))
# Counterfactual for growth in t+4
gt4 <- plm(growth ~ lag(growth, k = 5) + lag(growth, k=6) + lag(pop, k = 4) + lag(hc, k = 4) + lag(log(gdp), k = 4) + lag(log(capital), k = 4) + lag(productivity, k = 4) + lag(cpi, k = 4) + lag(restructure, k = 4) + lag(haircut, k = 4) + lag(I(haircut^2), k = 4) + lag(I(haircut^3), k = 4) + lag(debt, k = 4) + lag(fx, k = 4) + lag(haircut * fx, k = 4), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt4r <- coeftest(gt4, vcov.=vcovHC(gt4))
results <- data.frame(years)
# define some aux list
years <- c(year:(year+5))
haircuts <- seq(0, 1, by=.1)
# loop through the five regressions
# predict the growth rate
# calculate the gdp
for (i in 1:length(haircuts)){
print(i)
for (j in 1:(length(years))){
print (j)
# initialize the vectors to store growth and gdp
gs <- c()
gdp <- c(dataset$gdp[which(dataset$country==country & dataset$year == year)])
fe <- c()
# we need to calculate the FE for each period
# NOTE: I do not know how to do it "nicer"
if (j == 1){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt0, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt0r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 2){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt1, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt1r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 3){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt2, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt2r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 4){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt3, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt3r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 5){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt4, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt4r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
}
print(gdp)
results <- cbind(results, gdp)
}
return(result)
}
counterfactual(country, year, dataset)
#------------------------------------------------------------------------------------------------------------------------------------------
# Counterfactual functions
#------------------------------------------------------------------------------------------------------------------------------------------
# This function will create the counterfactual graph for a given country and restructure year
counterfactual <- function(country, year, dataset){
# Counterfactual for growth in t+0
# Standard Growth Regression + restructure + haircut + haircut2 + haircut3 + debt + fx (FE + Arellano)
gt0 <- plm(growth ~ lag(growth) + lag(growth, k=2) + pop + hc + log(gdp) + log(capital) + productivity + cpi + restructure + haircut + I(haircut^2) + I(haircut^3) + debt + fx + haircut * fx, data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt0r <- coeftest(gt0, vcov.=vcovHC(gt0))
# Counterfactual for growth in t+1
gt1 <- plm(growth ~ lag(growth, k = 2) + lag(growth, k=3) + lag(pop) + lag(hc) + lag(log(gdp)) + lag(log(capital)) + lag(productivity) + lag(cpi) + lag(restructure) + lag(haircut) + lag(I(haircut^2)) + lag(I(haircut^3)) + lag(debt) + lag(fx) + lag(haircut * fx), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt1r <- coeftest(gt1, vcov.=vcovHC(gt1))
# Counterfactual for growth in t+2
gt2 <- plm(growth ~ lag(growth, k = 3) + lag(growth, k=4) + lag(pop, k = 2) + lag(hc, k = 2) + lag(log(gdp), k = 2) + lag(log(capital), k = 2) + lag(productivity, k = 2) + lag(cpi, k = 2) + lag(restructure, k = 2) + lag(haircut, k = 2) + lag(I(haircut^2), k = 2) + lag(I(haircut^3), k = 2) + lag(debt, k = 2) + lag(fx, k = 2) + lag(haircut * fx, k = 2), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt2r <- coeftest(gt2, vcov.=vcovHC(gt2))
# Counterfactual for growth in t+3
gt3 <- plm(growth ~ lag(growth, k = 4) + lag(growth, k=5) + lag(pop, k = 3) + lag(hc, k = 3) + lag(log(gdp), k = 3) + lag(log(capital), k = 3) + lag(productivity, k = 3) + lag(cpi, k = 3) + lag(restructure, k = 3) + lag(haircut, k = 3) + lag(I(haircut^2), k = 3) + lag(I(haircut^3), k = 3) + lag(debt, k = 3) + lag(fx, k = 3) + lag(haircut * fx, k = 3), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt3r <- coeftest(gt3, vcov.=vcovHC(gt3))
# Counterfactual for growth in t+4
gt4 <- plm(growth ~ lag(growth, k = 5) + lag(growth, k=6) + lag(pop, k = 4) + lag(hc, k = 4) + lag(log(gdp), k = 4) + lag(log(capital), k = 4) + lag(productivity, k = 4) + lag(cpi, k = 4) + lag(restructure, k = 4) + lag(haircut, k = 4) + lag(I(haircut^2), k = 4) + lag(I(haircut^3), k = 4) + lag(debt, k = 4) + lag(fx, k = 4) + lag(haircut * fx, k = 4), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt4r <- coeftest(gt4, vcov.=vcovHC(gt4))
results <- data.frame(years)
# define some aux list
years <- c(year:(year+5))
haircuts <- seq(0, 1, by=.1)
# loop through the five regressions
# predict the growth rate
# calculate the gdp
for (i in 1:length(haircuts)){
print(i)
for (j in 1:(length(years))){
print (j)
# initialize the vectors to store growth and gdp
gs <- c()
gdp <- c(dataset$gdp[which(dataset$country==country & dataset$year == year)])
fe <- c()
# we need to calculate the FE for each period
# NOTE: I do not know how to do it "nicer"
if (j == 1){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt0, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt0r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 2){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt1, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt1r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 3){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt2, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt2r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 4){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt3, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt3r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 5){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt4, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt4r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
print(gdp)
}
results <- cbind(results, gdp)
}
return(result)
}
counterfactual(country, year, dataset)
# This function will create the counterfactual graph for a given country and restructure year
counterfactual <- function(country, year, dataset){
# Counterfactual for growth in t+0
# Standard Growth Regression + restructure + haircut + haircut2 + haircut3 + debt + fx (FE + Arellano)
gt0 <- plm(growth ~ lag(growth) + lag(growth, k=2) + pop + hc + log(gdp) + log(capital) + productivity + cpi + restructure + haircut + I(haircut^2) + I(haircut^3) + debt + fx + haircut * fx, data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt0r <- coeftest(gt0, vcov.=vcovHC(gt0))
# Counterfactual for growth in t+1
gt1 <- plm(growth ~ lag(growth, k = 2) + lag(growth, k=3) + lag(pop) + lag(hc) + lag(log(gdp)) + lag(log(capital)) + lag(productivity) + lag(cpi) + lag(restructure) + lag(haircut) + lag(I(haircut^2)) + lag(I(haircut^3)) + lag(debt) + lag(fx) + lag(haircut * fx), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt1r <- coeftest(gt1, vcov.=vcovHC(gt1))
# Counterfactual for growth in t+2
gt2 <- plm(growth ~ lag(growth, k = 3) + lag(growth, k=4) + lag(pop, k = 2) + lag(hc, k = 2) + lag(log(gdp), k = 2) + lag(log(capital), k = 2) + lag(productivity, k = 2) + lag(cpi, k = 2) + lag(restructure, k = 2) + lag(haircut, k = 2) + lag(I(haircut^2), k = 2) + lag(I(haircut^3), k = 2) + lag(debt, k = 2) + lag(fx, k = 2) + lag(haircut * fx, k = 2), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt2r <- coeftest(gt2, vcov.=vcovHC(gt2))
# Counterfactual for growth in t+3
gt3 <- plm(growth ~ lag(growth, k = 4) + lag(growth, k=5) + lag(pop, k = 3) + lag(hc, k = 3) + lag(log(gdp), k = 3) + lag(log(capital), k = 3) + lag(productivity, k = 3) + lag(cpi, k = 3) + lag(restructure, k = 3) + lag(haircut, k = 3) + lag(I(haircut^2), k = 3) + lag(I(haircut^3), k = 3) + lag(debt, k = 3) + lag(fx, k = 3) + lag(haircut * fx, k = 3), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt3r <- coeftest(gt3, vcov.=vcovHC(gt3))
# Counterfactual for growth in t+4
gt4 <- plm(growth ~ lag(growth, k = 5) + lag(growth, k=6) + lag(pop, k = 4) + lag(hc, k = 4) + lag(log(gdp), k = 4) + lag(log(capital), k = 4) + lag(productivity, k = 4) + lag(cpi, k = 4) + lag(restructure, k = 4) + lag(haircut, k = 4) + lag(I(haircut^2), k = 4) + lag(I(haircut^3), k = 4) + lag(debt, k = 4) + lag(fx, k = 4) + lag(haircut * fx, k = 4), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt4r <- coeftest(gt4, vcov.=vcovHC(gt4))
results <- data.frame(years)
# define some aux list
years <- c(year:(year+5))
haircuts <- seq(0, 1, by=.1)
# loop through the five regressions
# predict the growth rate
# calculate the gdp
for (i in 1:length(haircuts)){
print(i)
for (j in 1:(length(years))){
print (j)
# initialize the vectors to store growth and gdp
gs <- c()
gdp <- c(dataset$gdp[which(dataset$country==country & dataset$year == year)])
fe <- c()
# we need to calculate the FE for each period
# NOTE: I do not know how to do it "nicer"
if (j == 1){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt0, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt0r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 2){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt1, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt1r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 3){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt2, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt2r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 4){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt3, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt3r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 5){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt4, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt4r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
print(gdp)
}
results <- cbind(results, gdp)
}
return(results)
}
counterfactual(country, year, dataset)
# This function will create the counterfactual graph for a given country and restructure year
counterfactual <- function(country, year, dataset){
# Counterfactual for growth in t+0
# Standard Growth Regression + restructure + haircut + haircut2 + haircut3 + debt + fx (FE + Arellano)
gt0 <- plm(growth ~ lag(growth) + lag(growth, k=2) + pop + hc + log(gdp) + log(capital) + productivity + cpi + restructure + haircut + I(haircut^2) + I(haircut^3) + debt + fx + haircut * fx, data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt0r <- coeftest(gt0, vcov.=vcovHC(gt0))
# Counterfactual for growth in t+1
gt1 <- plm(growth ~ lag(growth, k = 2) + lag(growth, k=3) + lag(pop) + lag(hc) + lag(log(gdp)) + lag(log(capital)) + lag(productivity) + lag(cpi) + lag(restructure) + lag(haircut) + lag(I(haircut^2)) + lag(I(haircut^3)) + lag(debt) + lag(fx) + lag(haircut * fx), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt1r <- coeftest(gt1, vcov.=vcovHC(gt1))
# Counterfactual for growth in t+2
gt2 <- plm(growth ~ lag(growth, k = 3) + lag(growth, k=4) + lag(pop, k = 2) + lag(hc, k = 2) + lag(log(gdp), k = 2) + lag(log(capital), k = 2) + lag(productivity, k = 2) + lag(cpi, k = 2) + lag(restructure, k = 2) + lag(haircut, k = 2) + lag(I(haircut^2), k = 2) + lag(I(haircut^3), k = 2) + lag(debt, k = 2) + lag(fx, k = 2) + lag(haircut * fx, k = 2), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt2r <- coeftest(gt2, vcov.=vcovHC(gt2))
# Counterfactual for growth in t+3
gt3 <- plm(growth ~ lag(growth, k = 4) + lag(growth, k=5) + lag(pop, k = 3) + lag(hc, k = 3) + lag(log(gdp), k = 3) + lag(log(capital), k = 3) + lag(productivity, k = 3) + lag(cpi, k = 3) + lag(restructure, k = 3) + lag(haircut, k = 3) + lag(I(haircut^2), k = 3) + lag(I(haircut^3), k = 3) + lag(debt, k = 3) + lag(fx, k = 3) + lag(haircut * fx, k = 3), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt3r <- coeftest(gt3, vcov.=vcovHC(gt3))
# Counterfactual for growth in t+4
gt4 <- plm(growth ~ lag(growth, k = 5) + lag(growth, k=6) + lag(pop, k = 4) + lag(hc, k = 4) + lag(log(gdp), k = 4) + lag(log(capital), k = 4) + lag(productivity, k = 4) + lag(cpi, k = 4) + lag(restructure, k = 4) + lag(haircut, k = 4) + lag(I(haircut^2), k = 4) + lag(I(haircut^3), k = 4) + lag(debt, k = 4) + lag(fx, k = 4) + lag(haircut * fx, k = 4), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt4r <- coeftest(gt4, vcov.=vcovHC(gt4))
results <- data.frame(years)
# define some aux list
years <- c(year:(year+5))
haircuts <- seq(0, 1, by=.1)
# loop through the five regressions
# predict the growth rate
# calculate the gdp
for (i in 1:length(haircuts)){
print(i)
for (j in 1:(length(years))){
print (j)
# initialize the vectors to store growth and gdp
gs <- c()
gdp <- c(dataset$gdp[which(dataset$country==country & dataset$year == year)])
fe <- c()
# we need to calculate the FE for each period
# NOTE: I do not know how to do it "nicer"
if (j == 1){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt0, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt0r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 2){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt1, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt1r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 3){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt2, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt2r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 4){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt3, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt3r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 5){
# obtain the country FE
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt4, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt4r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
}
print(gs)
results <- cbind(results, gdp)
}
return(results)
}
counterfactual(country, year, dataset)
predict.cf(gt0r, country.data(country, year, dataset, haircuts[i]))
code <- dataset$code.v2[which(dataset$country==country & dataset$year == year)]
fes <- fixef(gt0, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
fe[1]
country
ixef(gt0, effect="individual")
fixef(gt0, effect="individual")
fes[which(names(fes)==country)]
as.numeric(fes[which(names(fes)==country)])
fe[j] = as.numeric(fes[which(names(fes)==country)])
fe
# This function will create the counterfactual graph for a given country and restructure year
counterfactual <- function(country, year, dataset){
# Counterfactual for growth in t+0
# Standard Growth Regression + restructure + haircut + haircut2 + haircut3 + debt + fx (FE + Arellano)
gt0 <- plm(growth ~ lag(growth) + lag(growth, k=2) + pop + hc + log(gdp) + log(capital) + productivity + cpi + restructure + haircut + I(haircut^2) + I(haircut^3) + debt + fx + haircut * fx, data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt0r <- coeftest(gt0, vcov.=vcovHC(gt0))
# Counterfactual for growth in t+1
gt1 <- plm(growth ~ lag(growth, k = 2) + lag(growth, k=3) + lag(pop) + lag(hc) + lag(log(gdp)) + lag(log(capital)) + lag(productivity) + lag(cpi) + lag(restructure) + lag(haircut) + lag(I(haircut^2)) + lag(I(haircut^3)) + lag(debt) + lag(fx) + lag(haircut * fx), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt1r <- coeftest(gt1, vcov.=vcovHC(gt1))
# Counterfactual for growth in t+2
gt2 <- plm(growth ~ lag(growth, k = 3) + lag(growth, k=4) + lag(pop, k = 2) + lag(hc, k = 2) + lag(log(gdp), k = 2) + lag(log(capital), k = 2) + lag(productivity, k = 2) + lag(cpi, k = 2) + lag(restructure, k = 2) + lag(haircut, k = 2) + lag(I(haircut^2), k = 2) + lag(I(haircut^3), k = 2) + lag(debt, k = 2) + lag(fx, k = 2) + lag(haircut * fx, k = 2), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt2r <- coeftest(gt2, vcov.=vcovHC(gt2))
# Counterfactual for growth in t+3
gt3 <- plm(growth ~ lag(growth, k = 4) + lag(growth, k=5) + lag(pop, k = 3) + lag(hc, k = 3) + lag(log(gdp), k = 3) + lag(log(capital), k = 3) + lag(productivity, k = 3) + lag(cpi, k = 3) + lag(restructure, k = 3) + lag(haircut, k = 3) + lag(I(haircut^2), k = 3) + lag(I(haircut^3), k = 3) + lag(debt, k = 3) + lag(fx, k = 3) + lag(haircut * fx, k = 3), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt3r <- coeftest(gt3, vcov.=vcovHC(gt3))
# Counterfactual for growth in t+4
gt4 <- plm(growth ~ lag(growth, k = 5) + lag(growth, k=6) + lag(pop, k = 4) + lag(hc, k = 4) + lag(log(gdp), k = 4) + lag(log(capital), k = 4) + lag(productivity, k = 4) + lag(cpi, k = 4) + lag(restructure, k = 4) + lag(haircut, k = 4) + lag(I(haircut^2), k = 4) + lag(I(haircut^3), k = 4) + lag(debt, k = 4) + lag(fx, k = 4) + lag(haircut * fx, k = 4), data=dataset, index=c("country", "year"),  model="within", methods="arellano")
gt4r <- coeftest(gt4, vcov.=vcovHC(gt4))
results <- data.frame(years)
# define some aux list
years <- c(year:(year+5))
haircuts <- seq(0, 1, by=.1)
# loop through the five regressions
# predict the growth rate
# calculate the gdp
for (i in 1:length(haircuts)){
print(i)
for (j in 1:(length(years))){
print (j)
# initialize the vectors to store growth and gdp
gs <- c()
gdp <- c(dataset$gdp[which(dataset$country==country & dataset$year == year)])
fe <- c()
# we need to calculate the FE for each period
# NOTE: I do not know how to do it "nicer"
if (j == 1){
# obtain the country FE
fes <- fixef(gt0, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt0r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 2){
# obtain the country FE
fes <- fixef(gt1, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt1r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 3){
# obtain the country FE
fes <- fixef(gt2, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt2r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 4){
# obtain the country FE
fes <- fixef(gt3, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt3r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
if (j == 5){
# obtain the country FE
fes <- fixef(gt4, effect="individual")
fe[j] = as.numeric(fes[which(names(fes)==country)])
gs[j] <- fe[j] + predict.cf(gt4r, country.data(country, year, dataset, haircuts[i]))
gdp[j+1] <- gdp[j]*(1+gs[j])
}
}
print(gs)
results <- cbind(results, gdp)
}
return(results)
}
counterfactual(country, year, dataset)
